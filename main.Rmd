---
title: "It's a feature not a bug"
subtitle: "Coercion, recycling and sub-setting"
author: "Pablo Adames"
institute: "CalgaryR"
date: "2024/09/24 (updated: `r Sys.Date()`)"
output:
  xaringan::moon_reader:
    css: xaringan-themer.css
    lib_dir: libs
    nature:
      highlightLines: true
      countIncrementalSlides: false
---
background-image: url(https://miro.medium.com/v2/resize:fit:640/format:webp/1*UH1ZkAzN4lLeWRDSggFq6Q.jpeg)
background-position: 50% 50%
background-size: 600px 485px

        
```{r setup, include=FALSE}
options(htmltools.dir.version = FALSE)
```
```{r xaringan-themer, include=FALSE, warning=FALSE}
library(xaringanthemer)
style_mono_accent(
  base_color = "#3e2f5b",
#  base_color = "#1c5253",
#  header_font_google = google_font("Josefin Sans"),
#  header_font_google = google_font("Noto Sans Japanese"),  
  header_font_google = google_font("Merriweather"),
#  text_font_google   = google_font("Montserrat", "300", "300i"),
  text_font_google   = google_font("Raleway", "400", "300i"),
#  code_font_google   = google_font("Fira Mono"),
  code_font_google   = google_font("Fira Code", "400", "500")
)

```


???

Image credit: [It's not a bug, it's a feature! at Medium.com](https://medium.com/@T45Investments/its-not-a-bug-it-s-a-feature-ca8f65a063ee)

---
class: center, middle

# When "by design" becomes an unsuspecting feature

### Or when ignorance is not bliss

???
  
It is commonly accepted that "Ignorance is bliss" means "you will be more comfortable if you don't know something"
However, when it comes to R syntax you will be much better off if you are fully aware of these fundamental language design decisions.

---

background-image: url(https://img.devrant.com/devrant/rant/r_61357_6PTYm.jpg)
background-position: 50% 50%

    
???
  
Image credit: [It's not a bug, it's a feature! at devrant.com](https://devrant.com/rants/61357/it-s-not-a-bug-it-s-an-undocumented-feature)

### Left may be the state of disbelief when you first encounter coercion and recycling 
### Right may represent the state of disbelief when you first learn that this was done by design
### Center may well be the state of belief after you learn about this features and start using them productively

---
class: center, middle

## Creative [computer language] design needs to be communicated

???
  
### Communicated is an euphemism for the more proper "taught".
### The reason is because we are not born in communities where we learn to use computer languages since we are born like human languages  

---
class: left, middle, inverse

#Coercion (koʊɜːʳʃən )
###uncountable noun

Coercion is the act or process of persuading someone forcefully to do something that they do not want to do.

_It was vital that the elections should be free of coercion or intimidation._

<span style="color:yellow">Synonyms:<span> force, pressure, threats, bullying

???
Source: [Collins online dictionary](https://www.collinsdictionary.com/dictionary/english/coercion)
---
background-image: url(https://www.memesmonkey.com/images/memesmonkey/3f/3fdbeaef7fb6720bf647b9e9e98df91d.jpeg)
background-position: 50% 50%
background-size: 600px 800px
background-color: Black
???

Image credit: [www.memesmonkey.com](https://www.memesmonkey.com/images/memesmonkey/3f/3fdbeaef7fb6720bf647b9e9e98df91d.jpeg)

### So R is a bully.

### Who does R bully/coerce and why?

---
class: left, middle
  
#Types in R

The fundamental values that R can represent and manipulate in the computer memory are:
  
```{r eval=require('DT'), tidy=TRUE, include=TRUE, echo=FALSE}
types <- data.frame(type=c("logical", "integer", "double", "character", "complex", "raw"),
                    examples=c("TRUE, T, FALSE, F", "2, 2L", "2.0, 43.9, 10", 
                               "'home', \"home2\", \"123\", \"$#.\"", 
                               "-1+i, 1i", "intToBits(2), charToRaw(\"A\")"))
#knitr::kable( types, format = "html")
DT::datatable( types, rownames = FALSE)
```
---
class: left, middle

#Data structures in R

```{r data structures, echo=FALSE, results='asis'}
library(knitr)
Dimensions <- c("One", "Two", "Three or more")
Homogeneous <- c("Vector", "Matrix", "Array")
Heterogeneous <- c("List", "Data frame", "")

kable( data.frame(Dimensions, Homogeneous, Heterogeneous,
                  stringsAsFactors = FALSE),
       caption = 'Native data structures in R according to the data type they can store and the number of dimensions they use [Advanced R, by Hadley Wickham, CRC Press, 2015, p.13].')
```
---
class: left, top

#Reasons R coerces data types without warning

--
- Let's verify that a vector gets all of its elements correctly
--
```{r, define-a-vector, error=TRUE, tidy.opts = list(blank = T, width.cutoff = 90)}
morning_temperatures <- c(Mon=16, Tue=18, Wed=15) 
typeof(morning_temperatures)
```
--
- Then try with heterogeneous input...

```{r, define-a-vector2, error=TRUE, tidy.opts = list(blank = T, width.cutoff = 90)}
morning_temperatures <- c(Mon=16, Tue=18, Wed="15C") 
typeof(morning_temperatures)
```
--
A vector is designed to store elements of the same type.

---
class: left, top
#A type hierarchy 

--
Types range from less to more general:
--

.pull-left[

```{r, less-to-more-general,echo=FALSE}
library(ggplot2)
library(data.table)
datat <- data.table(types=factor(c("logical", "integer", "integer","double","double","character"), levels =  c("logical","integer","double","character"), ordered = TRUE), how_general=factor(c("most specific","somewhat specific","somewhat specific","somewhat general","somewhat general","most general"), levels=c("most specific", "somewhat specific", "somewhat general", "most general"), ordered = TRUE), transition=c("to_integer","to_integer","to_double","to_double","to_character","to_character"))
ggplot(datat, aes(x=types, y= how_general, group=transition, color=transition))  + geom_line(arrow = arrow(type = "closed" ), linewidth = 1.75) + geom_point(size = 5, color = "red") + theme(text = element_text(size = 20), axis.text.y = element_text(angle = 0, hjust = 1), axis.text.x = element_text(angle = 45, hjust = 1), axis.title = element_blank()) 
  
```
]
--
.pull-right[

1. Every logical can be mapped to an integer

1. Every integer can be mapped to a double

1. Every double can be mapped to a character

Reversing these statements is impossible!

]
--
<img src="https://assets.bwbx.io/images/users/iqjWHBFdfxIU/iLsvH3JlemBk/v0/-1x-1.jpg"
     width="150px" height="150px"
     style="position:absolute; right:200px; top:480px;">

???

image-source: [https://assets.bwbx.io/](https://assets.bwbx.io/images/users/iqjWHBFdfxIU/iLsvH3JlemBk/v0/-1x-1.jpg)
---

class: left, top

#R coerces to avoid losing information


--

Converting data from one type to another can be a one-way street.

--

Given a choice of characters and doubles to store in a vector...

--

###R will choose the most general type.

--

And that is a 
<img src="https://assets.bwbx.io/images/users/iqjWHBFdfxIU/iLsvH3JlemBk/v0/-1x-1.jpg"
     width="200px" height="200px"
     style="position:absolute; right:500px; top:430px;">
---

##R coerces if pushed into a corner.

--

```{r, example-ceorcion-in-vector-assignment, echo=TRUE, highlight.output=T}
(temps <- c(15.3, 10.7, 20.1, 16.5, "12.8C", 17.2, 19.9))
```

--

Now let's try to reverse the process with our own coercion


```{r, example-coercion-in-vector-reverse, echo=TRUE, echo=c(2), highlight.output=T}
temps <- c(15.3, 10.7, 20.1, 16.5, "12.8C", 17.2, 19.9)
as.double(temps)
```

--

The net effect is missing values in the vector.

If we were to impute the missing value, it'd be harder because we have lost the original context. 


???

## All elements are coerced by R into characters, the most general type

## Recover the numbers 

## NAs are created by the reverse coercion

## that is information loss


---
class: left, top

#Reasons R coerces data types without warning

- A data structure makes assumptions for you
--
```{r, df-turns-characters-into-factors, tidy=FALSE}
df <- data.frame(temperatures=c(16, 18, 15, 6, 10),
                time_of_day=c("AM", "PM", "AM", "AM", "PM"))
str(df)
```

---
class: left, middle, inverse

#Recycle (riːsaɪkəl)

###transitive verb

1: to pass again through a series of changes or treatments: such as
     to save from loss and restore to usefulness, reclaim

4: to make ready for reuse

  _a plan to recycle vacant apartment buildings_

???
Source: [Merriam Webster''s online Dictionary](https://www.merriam-webster.com/dictionary/recycle)
---
background-image: url(https://i.pinimg.com/736x/8a/3f/e8/8a3fe88ce369c46593ddcbf80b2570ce--really-funny-pictures-funniest-pictures.jpg)
background-position: 50% 50%
background-size: 680px 680px
background-color: Black 

???
image credit: [i.pinimg.com](https://i.pinimg.com/736x/8a/3f/e8/8a3fe88ce369c46593ddcbf80b2570ce--really-funny-pictures-funniest-pictures.jpg)

---
class: left, middle, inverse

#Subsetting

###noun

The production of a subset. 

#Subset

###noun

A set whose members are members of another set; a set contained within another set

???
Source: [Wiktionary](https://www.wordnik.com/words/subset)

[From WordNet 3.0 Copyright 2006 by Princeton University. All rights reserved](https://www.wordnik.com/words/subset)
---
background-image: url(http://www.quickmeme.com/img/06/06d85daad5e49420eee5ccefd597782ca7ad37c03a306458f5ee865e6d22a5b6.jpg)
background-position: 50% 50%
background-size: contain 
background-color: LightGreen

???
Image credit: [http://www.quickmeme.com](http://www.quickmeme.com/img/06/06d85daad5e49420eee5ccefd597782ca7ad37c03a306458f5ee865e6d22a5b6.jpg)

---

class: center, middle

# Thanks!

### Slides coerced, recycled, and subsetted via the R packages [**xaringan**](https://github.com/yihui/xaringan) and  [**xaringanthemer**](https://pkg.garrickadenbuie.com/xaringanthemer/)

